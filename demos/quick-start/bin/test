#!/bin/bash
set -e

cleanup () {
  pushd test &>/dev/null
    docker-compose rm -fs
  popd &>/dev/null
}
trap cleanup EXIT ERR

pushd test &>/dev/null
  docker-compose up -d quickstart

  echo "Waiting for services to be running.."
  until docker-compose exec quickstart ls /run/postgresql/.init &>/dev/null; do
    sleep 1s
  done

  docker-compose up test-client
popd &>/dev/null