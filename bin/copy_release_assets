#!/usr/bin/env bash

set -eo pipefail

print_help() {
    echo "About $0: Copies release files into Github release asset directory."
    echo "Usage: $0 path/to/asset/release/directory"
    exit 1
}

if [[ "$#" -lt 1 ]]; then
    print_help
fi

asset_dir="$1"

if [[ ! -d "${asset_dir}" ]]; then
    echo "${asset_dir} directory does not exist."
    print_help
fi

goreleaser_dir="pristine-checkout/dist/goreleaser"
repo_root="$(git rev-parse --show-toplevel)"

root_assets=(
    "NOTICES.txt"
    "CHANGELOG.md"
    "LICENSE"
)

goreleaser_assets=(
    "SHA256SUMS.txt"
    *amd64
    *.tar.gz
    *.rpm
    *.deb
    *arm64
)

copy_assets() {
    local source_dir="$1"
    shift
    local assets=("$@")

    for asset in "${assets[@]}"; do
        # shellcheck disable=SC2086 # globbing is intentional for $asset
        cp "${source_dir}"/${asset} "$asset_dir"
    done
}

copy_assets "$repo_root" "${root_assets[@]}"
copy_assets "$goreleaser_dir" "${goreleaser_assets[@]}"
